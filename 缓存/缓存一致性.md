## 缓存一致性 Cache-Aside pattern

先更新数据库再删除缓存

1 A-read-cache miss
2 A-read-db
3 B-update-db
4 B-delete-cache
5 A-update-cache

有可能出现A读取的旧值在B删除缓存之后写入缓存
这依赖于B-update-db 速度快于A-read-db 但是基本写请求不会优于读请求 能解决大部分的不一致

删除缓存失败怎么办？

###### 缓存删除重试机制

1 业务代码重试
2 失败的key写入队列队列  队列再次消费 [业务入侵太强]
3 订阅数据库日志，写入消息队列 略复杂



失效：应用程序先从cache取数据，没有得到，则从数据库中取数据，成功后，放到缓存中。

命中：应用程序从cache中取数据，取到后返回。

更新：先把数据存到数据库中，成功后，再让缓存失效。